# AI音乐平台 V0.1 - 基础音乐生成版本

## 1. 系统概述

这是AI音乐平台的最小可行版本(MVP),仅实现基础的AI音乐生成功能。

### 1.1 系统架构
```yaml
架构图:
  [前端Next.js] → [API网关] → [音乐生成服务]
                              ↓
                          [PostgreSQL]
```

### 1.2 核心功能
```yaml
功能特性:
  - AI音乐生成API调用
  - 音乐文件存储
  - 基础音乐播放器
  - 简单的用户界面
```

## 2. 技术栈

### 2.1 后端技术
```yaml
框架与库:
  - Spring Boot 3.2
  - Spring Data JPA
  - Spring Web
  - Spring Actuator
  - Lombok
  - MapStruct
  - OpenAPI (Swagger)

数据库:
  - PostgreSQL 14
  - Flyway (数据库迁移)

构建工具:
  - Maven
  - Docker
  - Docker Compose

测试:
  - JUnit 5
  - Testcontainers
  - REST Assured
```

### 2.2 前端技术
```yaml
框架与库:
  - Next.js 14
  - React 18
  - TypeScript 5
  - TailwindCSS
  - Shadcn UI
  - React Query
  - Axios

构建工具:
  - Node.js 18
  - npm
```

## 3. 服务设计

### 3.1 音乐生成服务 (music-generation-service)
```yaml
端口: 8080
职责: 
  - 处理音乐生成请求
  - 管理音乐文件存储
  - 提供音乐元数据

API接口:
  POST /api/v1/music/generate:
    描述: 生成AI音乐
    请求体:
      prompt: string      # 音乐描述
      duration: integer   # 时长(秒)
      style: string      # 音乐风格
    响应:
      id: string         # 音乐ID
      status: string     # 生成状态
      
  GET /api/v1/music/{id}:
    描述: 获取音乐详情
    响应:
      id: string         # 音乐ID
      prompt: string     # 生成提示词
      style: string      # 音乐风格
      duration: integer  # 时长
      status: string     # 状态
      url: string       # 音频文件URL
      createdAt: date   # 创建时间

数据模型:
  Music:
    - id: UUID (PK)
    - prompt: String
    - style: String
    - duration: Integer
    - status: Enum (PENDING, PROCESSING, COMPLETED, FAILED)
    - url: String
    - createdAt: Timestamp
    - updatedAt: Timestamp
```

## 4. 数据库设计

### 4.1 PostgreSQL表结构
```sql
-- 音乐表
CREATE TABLE music (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    prompt VARCHAR(500) NOT NULL,
    style VARCHAR(100) NOT NULL,
    duration INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    url VARCHAR(500),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_music_status ON music(status);
CREATE INDEX idx_music_created_at ON music(created_at);
```

## 5. 部署架构

### 5.1 开发环境
```yaml
docker-compose.yml:
  services:
    music-generation-service:
      build: ./music-generation-service
      ports:
        - "8080:8080"
      environment:
        - SPRING_PROFILES_ACTIVE=dev
        - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/aimusic
        - SPRING_DATASOURCE_USERNAME=postgres
        - SPRING_DATASOURCE_PASSWORD=postgres
        - AI_API_KEY=${AI_API_KEY}
      depends_on:
        - postgres

    postgres:
      image: postgres:14-alpine
      ports:
        - "5432:5432"
      environment:
        - POSTGRES_DB=aimusic
        - POSTGRES_USER=postgres
        - POSTGRES_PASSWORD=postgres
      volumes:
        - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

## 6. 测试策略

### 6.1 测试范围
```yaml
单元测试:
  - Service层业务逻辑
  - Controller层参数验证
  - 数据模型映射
  
集成测试:
  - API端点测试
  - 数据库操作
  - 外部AI服务调用
  
E2E测试:
  - 音乐生成流程
  - 文件存储集成
```

## 7. 监控告警

### 7.1 监控指标
```yaml
系统指标:
  - API响应时间
  - JVM内存使用
  - 数据库连接池
  - 线程池状态
  
业务指标:
  - 音乐生成次数
  - 生成成功率
  - 平均生成时长
  - 存储空间使用
```

## 8. 升级规划

下一版本(V0.2)计划:
1. 添加用户认证服务
2. 实现用户注册登录
3. 支持音乐收藏功能 