# AI音乐平台 V0.2 - 用户认证版本

## 1. 系统概述

在V0.1基础上添加用户认证服务,实现用户注册、登录和音乐收藏功能。

### 1.1 核心功能
```yaml
继承V0.1功能:
  - AI音乐生成
  - 音乐播放器
  - 基础界面

新增功能:
  - 用户注册登录
  - 第三方认证(Google/GitHub)
  - 用户音乐收藏
  - 个人音乐库
```

## 2. 技术架构

### 2.1 技术栈
```yaml
# 继承V0.1全部技术栈
新增依赖:
  - NextAuth.js
  - Passport.js
  - JWT
  - Bcrypt
```

### 2.2 系统架构
```yaml
服务组件:
  # 继承V0.1的music-generation-service
  
  auth-service:
    - 用户认证管理
    - 会话控制
    - 权限验证
    
  user-service:
    - 用户信息管理
    - 音乐收藏
    - 个人偏好设置
```

## 3. API设计

### 3.1 认证服务
```yaml
POST /api/auth/register:
  描述: 用户注册
  请求体:
    email: string
    password: string
    name: string
  响应:
    userId: string
    token: string
    
POST /api/auth/login:
  描述: 用户登录
  请求体:
    email: string
    password: string
  响应:
    token: string
    user: object

GET /api/auth/me:
  描述: 获取当前用户信息
  请求头:
    Authorization: Bearer {token}
  响应:
    user: object
```

### 3.2 用户服务
```yaml
POST /api/users/favorites:
  描述: 收藏音乐
  请求体:
    musicId: string
  响应:
    success: boolean
    
GET /api/users/favorites:
  描述: 获取收藏列表
  响应:
    musics: array
    
DELETE /api/users/favorites/{musicId}:
  描述: 取消收藏
  响应:
    success: boolean
```

## 4. 数据模型

### 4.1 用户模型
```yaml
User:
  id: string          # 用户ID
  email: string       # 邮箱
  password: string    # 加密密码
  name: string        # 用户名
  avatar: string      # 头像URL
  createdAt: datetime # 创建时间
  updatedAt: datetime # 更新时间

UserFavorite:
  id: string          # 记录ID
  userId: string      # 用户ID
  musicId: string     # 音乐ID
  createdAt: datetime # 收藏时间
```

## 5. 部署架构

### 5.1 开发环境
```yaml
services:
  # 继承V0.1所有服务配置
  
  auth-service:
    port: 4001
    环境变量:
      - JWT_SECRET
      - GOOGLE_CLIENT_ID
      - GOOGLE_CLIENT_SECRET
      
  user-service:
    port: 4002
    环境变量:
      - DATABASE_URL
      - REDIS_URL
```

### 5.2 安全配置
```yaml
认证安全:
  - JWT过期时间: 7天
  - 密码加密: bcrypt(10轮)
  - CORS配置
  - Rate Limiting
  
会话管理:
  - Redis存储
  - 自动续期
  - 设备记录
```

## 6. 测试策略

### 6.1 测试范围
```yaml
# 继承V0.1所有测试

认证测试:
  - 注册流程
  - 登录验证
  - Token验证
  - 密码加密
  
用户测试:
  - 信息管理
  - 收藏操作
  - 权限控制
```

## 7. 监控告警

### 7.1 监控指标
```yaml
# 继承V0.1所有监控

新增指标:
  - 注册转化率
  - 登录成功率
  - 收藏数统计
  - 活跃用户数
```

## 8. 升级规划

下一版本(V0.3)计划:
1. 添加社交功能
2. 音乐分享系统
3. 用户评论功能 