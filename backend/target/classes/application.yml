spring:
  application:
    name: ai-music-backend
  
  # 数据源配置
  datasource:
    url: ${DATABASE_URL}
    username: ${POSTGRES_USER}
    password: ${POSTGRES_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000
      
  # JPA配置
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        
  # Flyway配置
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    
# 缓存配置
cache:
  type: caffeine
  caffeine:
    spec: maximumSize=500,expireAfterWrite=30m

# Suno API配置
suno:
  api:
    base-url: ${SUNO_API_BASE_URL:https://api.suno.ai}
    api-key: ${SUNO_API_KEY}
    connect-timeout: 30
    read-timeout: 30
    max-retries: 3
    
# 服务器配置
server:
  port: ${PORT:8080}
  servlet:
    context-path: /api/v1
    
# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
      cors:
        allowed-origins: "*"
        allowed-methods: GET
  endpoint:
    health:
      show-details: when_authorized
      roles: ADMIN
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
      sla:
        http.server.requests: 10ms, 50ms, 100ms, 200ms, 500ms
    enable:
      jvm: true
      process: true
      system: true
      logback: true
      tomcat: true
      jdbc: true
      http: true
      
# OpenAPI配置
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    config-url: /api/v1/api-docs/swagger-config
    url: /api/v1/api-docs
  show-actuator: true
  
# 日志配置
logging:
  level:
    root: INFO
    com.aimusic: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE 

# 存储配置
storage:
  location: uploads
  max-file-size: 104857600  # 100MB
  allowed-file-types:
    - .mp3
    - .wav
    - .m4a
    - .aac
  url-prefix: /files
  temp-dir: temp
  use-original-filename: false
  max-filename-length: 100 